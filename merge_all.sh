#!/bin/bash

# جلب قائمة بـ 1000 رقم لطلبات السحب المفتوحة
prs=$(gh pr list --limit 1000 --json number --jq '.[].number')

# التحقق من وجود طلبات سحب
if [ -z "$prs" ]; then
  echo "لا توجد طلبات سحب مفتوحة حالياً."
  exit 0
fi

echo "بدء دمج طلبات السحب..."

for pr in $prs; do
  echo "-----------------------------------"
  echo "جاري معالجة PR رقم: #$pr"
  
  # محاولة الدمج وحذف الفرع تلقائياً
  gh pr merge $pr --merge --delete-branch || echo "فشل الدمج التلقائي لـ #$pr (قد يكون هناك تعارض)"
done

echo "-----------------------------------"
echo "انتهت العملية!"
